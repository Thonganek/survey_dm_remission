<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ NCDs Remission | ‡πÄ‡∏Ç‡∏ï‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 7</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#fff1f2', 
                            100: '#ffe4e6', 
                            200: '#fecdd3', 
                            300: '#fda4af', 
                            400: '#fb7185', 
                            500: '#f43f5e', 
                            600: '#e11d48',
                            700: '#be123c',
                            800: '#9f1239', 
                            900: '#881337', 
                        },
                        gold: {
                            400: '#d4a373', 
                            500: '#c58f5e', 
                            600: '#b07d4e',
                        }
                    },
                    fontFamily: {
                        sans: ['Sarabun', 'sans-serif'],
                        heading: ['Prompt', 'sans-serif'],
                    },
                    boxShadow: {
                        'pink-glow': '0 4px 20px -2px rgba(251, 113, 133, 0.3)',
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts: Sarabun & Prompt -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            background: linear-gradient(135deg, #fff1f2 0%, #fff5f7 50%, #ffe4e6 100%);
            min-height: 100vh;
        }
        h1, h2, h3, .heading-font { font-family: 'Prompt', sans-serif; }
        
        .glass {
            background: rgba(255, 255, 255, 0.90);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 228, 230, 0.5);
        }
        
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .required::after { content: " *"; color: #f43f5e; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #fff1f2; }
        ::-webkit-scrollbar-thumb { background: #fda4af; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #fb7185; }

        .option-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .option-card:hover {
            border-color: #fb7185;
            background-color: #fff1f2;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(251, 113, 133, 0.15);
        }
        input:checked + .option-card {
            border-color: #f43f5e;
            background-color: #fff0f3;
            box-shadow: 0 4px 12px -2px rgba(244, 63, 94, 0.25);
        }
        input:checked + .option-card .check-circle {
            background-color: #f43f5e;
            border-color: #f43f5e;
        }
        input:checked + .option-card .check-circle::after {
            content: '';
            display: block;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

        .likert-btn-wrapper:hover .likert-btn {
            border-color: #fb7185;
            background-color: #fff1f2;
            color: #be123c;
        }
        input:checked + .likert-btn {
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 10px rgba(225, 29, 72, 0.4);
            transform: scale(1.1);
        }

        .pii-warning { border: 2px solid #f43f5e !important; background-color: #fff1f2; animation: pulse 2s infinite; }

        .chart-card { background: white; border-radius: 1.5rem; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border: 1px solid #ffe4e6; }
        .chart-title { font-family: 'Prompt', sans-serif; font-weight: 600; color: #881337; margin-bottom: 1rem; border-bottom: 1px solid #fff1f2; padding-bottom: 0.5rem; font-size: 1rem; }
        
        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .data-table th {
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
        }
        .data-table td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid #ffe4e6;
            color: #881337;
        }
        .data-table tr:hover {
            background-color: #fff1f2;
        }
        .data-table tr:last-child td {
            border-bottom: none;
        }
        .table-container {
            background: white;
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #ffe4e6;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255, 241, 242, 0.5); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #fda4af; border-radius: 4px; }
    </style>
</head>
<body class="text-brand-800 antialiased selection:bg-brand-200 selection:text-brand-900">

    <!-- Header -->
    <header class="glass sticky top-0 z-40 border-b border-brand-100 shadow-sm">
        <div class="h-1 bg-gradient-to-r from-brand-300 via-brand-500 to-brand-300"></div>
        <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-brand-400 to-brand-600 flex items-center justify-center text-white font-bold text-xl shadow-pink-glow transform rotate-3 hover:rotate-0 transition-transform duration-300">
                    D7
                </div>
                <div>
                    <h1 class="text-lg md:text-xl font-bold text-brand-900 leading-tight tracking-tight">‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô NCDs Remission</h1>
                    <p class="text-xs text-gold-500 font-medium tracking-wide uppercase">DPC 7 Khon Kaen</p>
                </div>
            </div>
            <button onclick="toggleDashboard()" class="hidden md:flex items-center gap-2 text-sm font-medium bg-white text-brand-700 px-5 py-2 rounded-full border border-brand-200 hover:bg-brand-50 hover:text-brand-900 transition-all shadow-sm hover:shadow-md group">
                <span class="group-hover:scale-110 transition-transform text-xl">üìä</span>
                <span>Dashboard</span>
            </button>
        </div>
        <div class="w-full bg-brand-50 h-1.5 overflow-hidden">
            <div id="progressBar" class="bg-gradient-to-r from-brand-400 to-brand-600 h-1.5 transition-all duration-700 ease-out shadow-[0_0_10px_rgba(244,63,94,0.5)]" style="width: 0%"></div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-10 mb-20">
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="fixed inset-0 bg-white/80 backdrop-blur-md z-50 hidden flex items-center justify-center flex-col">
            <div class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-sm w-full mx-4 border border-brand-100">
                <div class="animate-spin rounded-full h-12 w-12 border-4 border-brand-100 border-t-brand-500 mx-auto mb-4"></div>
                <h3 class="text-lg font-bold text-brand-900">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>
                <p class="text-brand-400 text-sm mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</p>
            </div>
        </div>

        <!-- ASSESSMENT FORM CARD -->
        <div class="bg-white/80 backdrop-blur-sm rounded-[2rem] shadow-pink-glow border border-white/50 overflow-hidden relative">
            <div class="absolute -top-24 -right-24 w-64 h-64 bg-brand-200/20 rounded-full blur-3xl pointer-events-none"></div>
            <div class="absolute top-1/2 -left-24 w-64 h-64 bg-gold-400/10 rounded-full blur-3xl pointer-events-none"></div>

            <form id="assessmentForm" onsubmit="event.preventDefault();" class="relative z-10">
                
                <!-- Section 0: Intro & Consent -->
                <div id="step0" class="step-content active p-8 md:p-12">
                    <div class="text-center mb-10">
                        <span class="inline-block px-4 py-1.5 bg-brand-50 text-brand-600 rounded-full text-xs font-bold mb-4 tracking-wider shadow-sm uppercase">Survey 2024</span>
                        <h2 class="text-3xl md:text-4xl font-bold text-brand-900 mb-4 tracking-tight">‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
                        <div class="h-1.5 w-24 bg-gradient-to-r from-brand-300 to-brand-500 mx-auto rounded-full opacity-80"></div>
                    </div>
                    
                    <p class="mb-8 leading-relaxed text-brand-700 text-center max-w-2xl mx-auto text-lg">
                        ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô <span class="text-brand-600 font-bold bg-brand-50 px-1 rounded">NCDs Remission (DM Remission)</span> ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 7
                    </p>

                    <div class="bg-white/60 border border-brand-100 rounded-2xl p-6 mb-10 relative overflow-hidden group shadow-sm">
                        <div class="absolute top-0 left-0 w-1.5 h-full bg-brand-400"></div>
                        <h3 class="font-bold text-brand-900 mb-3 flex items-center gap-2 text-lg">
                            <svg class="w-6 h-6 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                            ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (PDPA)
                        </h3>
                        <ul class="text-sm space-y-3 text-brand-700 ml-2">
                            <li class="flex items-start gap-3"><span class="w-1.5 h-1.5 rounded-full bg-brand-400 mt-2 shrink-0"></span>‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</li>
                            <li class="flex items-start gap-3"><span class="w-1.5 h-1.5 rounded-full bg-brand-400 mt-2 shrink-0"></span>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ</li>
                            <li class="flex items-start gap-3"><span class="w-1.5 h-1.5 rounded-full bg-brand-400 mt-2 shrink-0"></span>‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</li>
                        </ul>
                    </div>

                    <div class="border-t border-brand-100 pt-8">
                        <label class="block font-bold mb-6 text-xl text-brand-900 text-center required">‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</label>
                        <div class="grid md:grid-cols-2 gap-5 max-w-2xl mx-auto">
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="consent" value="agree" class="peer sr-only" onchange="checkConsent(this.value)">
                                <div class="option-card p-6 rounded-2xl border border-brand-200 bg-white h-full flex items-center gap-4 transition-all hover:border-brand-400">
                                    <div class="check-circle w-7 h-7 rounded-full border-2 border-brand-200 flex items-center justify-center shrink-0 transition-all bg-brand-50 text-brand-600"></div>
                                    <div>
                                        <span class="block font-bold text-lg text-brand-900">‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</span>
                                        <span class="text-sm text-brand-500">‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span>
                                    </div>
                                </div>
                            </label>
                            <label class="cursor-pointer relative group">
                                <input type="radio" name="consent" value="disagree" class="peer sr-only" onchange="checkConsent(this.value)">
                                <div class="option-card p-6 rounded-2xl border border-gray-200 bg-white h-full flex items-center gap-4 transition-all">
                                    <div class="check-circle w-7 h-7 rounded-full border-2 border-gray-200 flex items-center justify-center shrink-0 transition-all"></div>
                                    <div>
                                        <span class="block font-bold text-lg text-gray-600">‡πÑ‡∏°‡πà‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</span>
                                        <span class="text-sm text-gray-400">‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</span>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Section 1: General Info -->
                <div id="step1" class="step-content p-8 md:p-12">
                    <h2 class="text-2xl font-bold mb-8 text-brand-900 flex items-center gap-3 pb-4 border-b border-brand-100">
                        <span class="flex items-center justify-center w-10 h-10 rounded-full bg-brand-100 text-brand-600 text-lg shadow-sm">1</span>
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                    </h2>
                    
                    <div class="space-y-8">
                        <!-- Q1 -->
                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">1. ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</label>
                            <div class="relative">
                                <select name="q1" class="w-full appearance-none border border-brand-200 rounded-xl p-4 pl-5 pr-10 focus:ring-2 focus:ring-brand-400 focus:border-brand-400 outline-none transition-all bg-white text-brand-900" onchange="handleSpecificInput('q1', 'q1_other')">
                                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                                    <option value="‡∏™‡∏™‡∏à.">‡∏™‡∏™‡∏à.</option>
                                    <option value="‡∏£‡∏û‡∏®./‡∏£‡∏û‡∏ó.">‡∏£‡∏û‡∏®./‡∏£‡∏û‡∏ó.</option>
                                    <option value="‡∏£‡∏û‡∏ä.">‡∏£‡∏û‡∏ä.</option>
                                    <option value="‡∏™‡∏™‡∏≠.">‡∏™‡∏™‡∏≠.</option>
                                    <option value="‡∏£‡∏û.‡∏™‡∏ï.">‡∏£‡∏û.‡∏™‡∏ï.</option>
                                    <option value="‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç</option>
                                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-brand-400">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </div>
                            </div>
                            <input type="text" name="q1_other" id="q1_other" class="mt-3 w-full border border-brand-100 rounded-xl p-3 bg-brand-50 focus:bg-white focus:ring-2 focus:ring-brand-400 outline-none transition-all text-brand-900" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô" disabled>
                        </div>

                        <!-- Q2 -->
                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">2. ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <script>
                                    ['‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î', '‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô', '‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°', '‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå'].forEach(prov => {
                                        document.write(`
                                            <label class="cursor-pointer group">
                                                <input type="radio" name="q2" value="${prov}" class="peer sr-only">
                                                <div class="option-card p-4 rounded-xl border border-brand-200 text-center bg-white hover:bg-brand-50 transition-all h-full flex items-center justify-center">
                                                    <span class="text-base font-medium text-brand-700 peer-checked:text-brand-900 peer-checked:font-bold">${prov}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>

                        <!-- Q3 -->
                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">3. ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
                            <div class="relative">
                                <select name="q3" class="w-full appearance-none border border-brand-200 rounded-xl p-4 pl-5 pr-10 focus:ring-2 focus:ring-brand-400 outline-none bg-white text-brand-900" onchange="handleSpecificInput('q3', 'q3_other')">
                                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                                    <option value="‡πÅ‡∏û‡∏ó‡∏¢‡πå">‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
                                    <option value="‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û (NCD Manager/Case Manager)">‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û (NCD Manager/Case Manager)</option>
                                    <option value="‡∏ô‡∏±‡∏Å‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£/‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏£">‡∏ô‡∏±‡∏Å‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£/‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏£</option>
                                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç">‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç</option>
                                    <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç">‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç</option>
                                    <option value="‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£">‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£</option>
                                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-brand-400">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </div>
                            </div>
                            <input type="text" name="q3_other" id="q3_other" class="mt-3 w-full border border-brand-100 rounded-xl p-3 bg-brand-50 text-brand-900" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" disabled>
                        </div>

                        <!-- Q4 -->
                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">4. ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏á‡∏≤‡∏ô NCDs</label>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <script>
                                    ['‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏õ‡∏µ', '1 - 3 ‡∏õ‡∏µ', '4 - 6 ‡∏õ‡∏µ', '7 - 9 ‡∏õ‡∏µ', '10 ‡∏õ‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ'].forEach(exp => {
                                        document.write(`
                                            <label class="cursor-pointer">
                                                <input type="radio" name="q4" value="${exp}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-center gap-4">
                                                    <div class="check-circle w-5 h-5 rounded-full border border-brand-300 flex items-center justify-center shrink-0"></div>
                                                    <span class="text-brand-700">${exp}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Situation -->
                <div id="step2" class="step-content p-8 md:p-12">
                    <h2 class="text-2xl font-bold mb-8 text-brand-900 flex items-center gap-3 pb-4 border-b border-brand-100">
                        <span class="flex items-center justify-center w-10 h-10 rounded-full bg-brand-100 text-brand-600 text-lg shadow-sm">2</span>
                        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô
                    </h2>
                    
                    <div class="space-y-8">
                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">5. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô DM Remission</label>
                            <div class="space-y-3">
                                <script>
                                    ['‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏ò‡∏£‡∏£‡∏°', '‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°/‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏à‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô'].forEach(opt => {
                                        document.write(`
                                            <label class="cursor-pointer block">
                                                <input type="radio" name="q5" value="${opt}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-center gap-4 hover:bg-brand-50">
                                                    <div class="check-circle w-5 h-5 rounded-full border border-brand-300 shrink-0"></div>
                                                    <span class="text-brand-700 font-medium">${opt}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>

                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">6. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå/‡∏ô‡∏¥‡∏¢‡∏≤‡∏° DM Remission</label>
                             <div class="space-y-3">
                                <script>
                                    ['‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ', '‡∏û‡∏≠‡∏£‡∏π‡πâ‡∏ö‡πâ‡∏≤‡∏á ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô', '‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô'].forEach(opt => {
                                        document.write(`
                                            <label class="cursor-pointer block">
                                                <input type="radio" name="q6" value="${opt}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-center gap-4 hover:bg-brand-50">
                                                    <div class="check-circle w-5 h-5 rounded-full border border-brand-300 shrink-0"></div>
                                                    <span class="text-brand-700 font-medium">${opt}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block font-bold mb-3 text-brand-800 required text-lg">7. ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô HbA1c < 7%</label>
                                <div class="relative">
                                    <select name="q7" class="w-full appearance-none border border-brand-200 rounded-xl p-4 pl-5 pr-10 bg-white text-brand-900 focus:ring-2 focus:ring-brand-400 outline-none">
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á --</option>
                                        <option value="‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20">< 20%</option>
                                        <option value="‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20 - 39">20% - 39%</option>
                                        <option value="‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 40 - 59">40% - 59%</option>
                                        <option value="‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 60 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ">> 60%</option>
                                        <option value="‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-brand-400">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block font-bold mb-3 text-brand-800 required text-lg">8. ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á</label>
                                <div class="relative">
                                    <select name="q8" class="w-full appearance-none border border-brand-200 rounded-xl p-4 pl-5 pr-10 bg-white text-brand-900 focus:ring-2 focus:ring-brand-400 outline-none">
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á --</option>
                                        <option value="‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20">< 20%</option>
                                        <option value="‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20 - 39">20% - 39%</option>
                                        <option value="‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 40 - 59">40% - 59%</option>
                                        <option value="‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 60 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ">> 60%</option>
                                        <option value="‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-brand-400">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">9. ‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1)</label>
                            <div class="grid md:grid-cols-2 gap-4">
                                <script>
                                    ['‡∏Ç‡∏≤‡∏î‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£/‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡∏Å', '‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á DM Remission', '‡∏Ç‡∏≤‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠/‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ', '‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠/‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏≤‡∏Å', '‡∏Ç‡∏≤‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á'].forEach(val => {
                                        document.write(`
                                            <label class="cursor-pointer block h-full">
                                                <input type="checkbox" name="q9" value="${val}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-start gap-3 h-full hover:bg-brand-50">
                                                    <div class="w-5 h-5 rounded border border-brand-300 flex items-center justify-center shrink-0 mt-0.5 peer-checked:bg-brand-500 peer-checked:border-brand-500 text-white transition-colors">
                                                        <svg class="w-3.5 h-3.5 opacity-0 peer-checked:opacity-100" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg>
                                                    </div>
                                                    <span class="text-sm text-brand-800 leading-relaxed">${val}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                                <label class="cursor-pointer block h-full">
                                    <input type="checkbox" name="q9" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="peer sr-only" onchange="toggleCheckboxOther(this, 'q9_other')">
                                    <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex flex-col gap-2 h-full">
                                        <div class="flex items-center gap-3">
                                             <div class="w-5 h-5 rounded border border-brand-300 flex items-center justify-center shrink-0 peer-checked:bg-brand-500 peer-checked:border-brand-500 text-white">
                                                <svg class="w-3.5 h-3.5 opacity-0 peer-checked:opacity-100" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg>
                                            </div>
                                            <span class="text-sm text-brand-800">‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏£‡∏∞‡∏ö‡∏∏</span>
                                        </div>
                                        <input type="text" name="q9_other" id="q9_other" class="w-full text-sm border-b border-brand-200 focus:border-brand-500 outline-none bg-transparent p-1 disabled:opacity-50 text-brand-900" disabled>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Readiness -->
                <div id="step3" class="step-content p-8 md:p-12">
                    <h2 class="text-2xl font-bold mb-2 text-brand-900 flex items-center gap-3">
                        <span class="flex items-center justify-center w-10 h-10 rounded-full bg-brand-100 text-brand-600 text-lg shadow-sm">3</span>
                        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô
                    </h2>
                    <p class="text-brand-400 mb-10 ml-14 text-sm font-medium tracking-wide">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç: 5 = ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î, 1 = ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)</p>

                    <div class="space-y-6">
                        <script>
                            const readinessItems = [
                                {id: "q10", text: "‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£"},
                                {id: "q11", text: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£"},
                                {id: "q12", text: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô"},
                                {id: "q13", text: "‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®"},
                                {id: "q14", text: "‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏Ñ‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢/‡∏ä‡∏∏‡∏°‡∏ä‡∏ô"},
                                {id: "q15", text: "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô"}
                            ];
                            readinessItems.forEach(item => {
                                document.write(`
                                    <div class="bg-white/60 p-6 rounded-2xl border border-brand-100 hover:border-brand-300 hover:shadow-lg transition-all">
                                        <p class="font-bold text-brand-800 mb-4 text-base md:text-lg required">${item.text}</p>
                                        <div class="flex justify-between items-center max-w-lg mx-auto gap-2">
                                            <span class="text-xs text-brand-300 font-bold uppercase tracking-wider hidden md:block">‡∏ô‡πâ‡∏≠‡∏¢</span>
                                            ${[1, 2, 3, 4, 5].map(v => `
                                                <label class="cursor-pointer likert-btn-wrapper">
                                                    <input type="radio" name="${item.id}" value="${v}" class="peer sr-only">
                                                    <div class="likert-btn w-10 h-10 md:w-12 md:h-12 rounded-full border-2 border-brand-100 flex items-center justify-center text-brand-300 font-bold text-lg md:text-xl transition-all duration-300">
                                                        ${v}
                                                    </div>
                                                </label>
                                            `).join('')}
                                            <span class="text-xs text-brand-300 font-bold uppercase tracking-wider hidden md:block">‡∏°‡∏≤‡∏Å</span>
                                        </div>
                                    </div>
                                `);
                            });
                        </script>
                    </div>
                </div>

                <!-- Section 4: Needs -->
                <div id="step4" class="step-content p-8 md:p-12">
                     <h2 class="text-2xl font-bold mb-8 text-brand-900 flex items-center gap-3 pb-4 border-b border-brand-100">
                        <span class="flex items-center justify-center w-10 h-10 rounded-full bg-brand-100 text-brand-600 text-lg shadow-sm">4</span>
                        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô
                    </h2>

                    <div class="space-y-8">
                         <!-- Q16 -->
                         <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">16. ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á NCDs Remission ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <script>
                                    ['‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô', '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', '‡πÄ‡∏â‡∏¢‡πÜ/‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à', '‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'].forEach(opt => {
                                        document.write(`
                                            <label class="cursor-pointer">
                                                <input type="radio" name="q16" value="${opt}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white hover:bg-brand-50">
                                                    <span class="text-sm font-medium text-brand-700 peer-checked:text-brand-900">${opt}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>

                        <!-- Q17 -->
                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">17. ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1)</label>
                            <div class="grid md:grid-cols-2 gap-3">
                                <script>
                                    ['‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢', '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°', '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏¢‡∏≤ (Deprescribing)', '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Flow Chart', '‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á'].forEach(val => {
                                        document.write(`
                                            <label class="cursor-pointer block">
                                                <input type="checkbox" name="q17" value="${val}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-center gap-3 hover:bg-brand-50">
                                                    <div class="w-5 h-5 rounded border border-brand-300 flex items-center justify-center shrink-0 peer-checked:bg-brand-500 peer-checked:border-brand-500 text-white"><svg class="w-3 h-3 opacity-0 peer-checked:opacity-100" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg></div>
                                                    <span class="text-sm text-brand-700">${val}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                                <label class="cursor-pointer block">
                                    <input type="checkbox" name="q17" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="peer sr-only" onchange="toggleCheckboxOther(this, 'q17_other')">
                                    <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex flex-col gap-2">
                                        <div class="flex items-center gap-3">
                                            <div class="w-5 h-5 rounded border border-brand-300 flex items-center justify-center shrink-0 peer-checked:bg-brand-500 peer-checked:border-brand-500 text-white"><svg class="w-3 h-3 opacity-0 peer-checked:opacity-100" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg></div>
                                            <span class="text-sm text-brand-700">‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏£‡∏∞‡∏ö‡∏∏</span>
                                        </div>
                                        <input type="text" name="q17_other" id="q17_other" class="w-full text-sm border-b border-brand-200 p-1 disabled:bg-transparent text-brand-900" disabled>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Q18 -->
                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">18. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
                             <div class="grid md:grid-cols-2 gap-3">
                                <script>
                                    ['E-book / PDF', '‡∏£‡∏π‡∏õ‡πÄ‡∏•‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', 'Infographic / ‡πÅ‡∏ú‡πà‡∏ô‡∏û‡∏±‡∏ö', '‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠', 'App / Web tool'].forEach(val => {
                                         document.write(`
                                            <label class="cursor-pointer block">
                                                <input type="checkbox" name="q18" value="${val}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-center gap-3 hover:bg-brand-50">
                                                    <div class="w-5 h-5 rounded border border-brand-300 flex items-center justify-center shrink-0 peer-checked:bg-brand-500 peer-checked:border-brand-500 text-white"><svg class="w-3 h-3 opacity-0 peer-checked:opacity-100" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg></div>
                                                    <span class="text-sm text-brand-700">${val}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>
                        
                        <!-- Support Levels -->
                        <div class="bg-brand-50/50 p-6 md:p-8 rounded-[2rem] border border-brand-100 mt-6">
                            <h3 class="font-bold text-brand-900 mb-6 text-center text-xl">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô</h3>
                             <div class="space-y-6">
                                <script>
                                    const supportItems = [
                                        {id: "q19", text: "‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û"},
                                        {id: "q20", text: "‡∏™‡∏∑‡πà‡∏≠/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ"},
                                        {id: "q21", text: "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì"},
                                        {id: "q22", text: "‡πÄ‡∏ß‡∏ó‡∏µ‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ"},
                                        {id: "q23", text: "‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á/Consult"},
                                        {id: "q24", text: "‡∏Å‡∏≤‡∏£‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏û‡∏•‡∏±‡∏á"}
                                    ];
                                    supportItems.forEach(item => {
                                        document.write(`
                                            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 border-b border-brand-100 pb-5 last:border-0 last:pb-0">
                                                <span class="text-sm md:text-base text-brand-800 font-bold md:w-5/12 required">${item.text}</span>
                                                <div class="flex justify-between md:justify-end gap-2 md:gap-3 md:w-7/12">
                                                    ${[1, 2, 3, 4, 5].map(v => `
                                                        <label class="cursor-pointer likert-btn-wrapper">
                                                            <input type="radio" name="${item.id}" value="${v}" class="peer sr-only">
                                                            <div class="likert-btn w-9 h-9 md:w-11 md:h-11 rounded-full border-2 border-brand-200 flex items-center justify-center text-brand-400 font-bold text-base md:text-lg transition-all duration-300">
                                                                ${v}
                                                            </div>
                                                        </label>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 5: Area Specific -->
                <div id="step5" class="step-content p-8 md:p-12">
                     <h2 class="text-2xl font-bold mb-8 text-brand-900 flex items-center gap-3 pb-4 border-b border-brand-100">
                        <span class="flex items-center justify-center w-10 h-10 rounded-full bg-brand-100 text-brand-600 text-lg shadow-sm">5</span>
                        ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏•‡∏î‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á)
                    </h2>

                    <div class="space-y-8">
                        <div>
                             <label class="block font-bold mb-3 text-brand-800 required text-lg">25. ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏•‡∏î‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
                             <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <script>
                                    ['‡∏°‡∏µ ‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á', '‡∏°‡∏µ ‡πÅ‡∏ï‡πà‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á', '‡πÑ‡∏°‡πà‡∏°‡∏µ'].forEach(opt => {
                                         document.write(`
                                            <label class="cursor-pointer">
                                                <input type="radio" name="q25" value="${opt}" class="peer sr-only">
                                                <div class="option-card px-4 py-4 rounded-xl border border-brand-200 bg-white hover:bg-brand-50 text-center h-full flex items-center justify-center">
                                                    <span class="text-sm font-medium text-brand-700 peer-checked:text-brand-900">${opt}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>

                        <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">26. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
                            <div class="grid md:grid-cols-2 gap-3">
                                <script>
                                    ['‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å DPAC / ‡πÑ‡∏£‡πâ‡∏û‡∏∏‡∏á', '‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö', '‡∏£‡∏ì‡∏£‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏ä‡∏∏‡∏°‡∏ä‡∏ô', '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'].forEach(val => {
                                        document.write(`
                                            <label class="cursor-pointer block">
                                                <input type="checkbox" name="q26" value="${val}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-center gap-3 hover:bg-brand-50">
                                                    <div class="w-5 h-5 rounded border border-brand-300 flex items-center justify-center shrink-0 peer-checked:bg-brand-500 peer-checked:border-brand-500 text-white"><svg class="w-3 h-3 opacity-0 peer-checked:opacity-100" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg></div>
                                                    <span class="text-sm text-brand-700">${val}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                                <label class="cursor-pointer block">
                                    <input type="checkbox" name="q26" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="peer sr-only" onchange="toggleCheckboxOther(this, 'q26_other')">
                                    <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-center gap-3">
                                         <span class="text-sm text-brand-700 shrink-0">‡∏≠‡∏∑‡πà‡∏ô‡πÜ:</span>
                                         <input type="text" name="q26_other" id="q26_other" class="w-full text-sm border-b border-brand-200 p-1 bg-transparent focus:border-brand-500 outline-none text-brand-900" disabled>
                                    </div>
                                </label>
                            </div>
                        </div>

                         <div>
                            <label class="block font-bold mb-3 text-brand-800 required text-lg">27. ‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ</label>
                            <div class="grid md:grid-cols-2 gap-3">
                                <script>
                                    ['‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏ô', '‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°', '‡∏Ç‡∏≤‡∏î‡πÅ‡∏£‡∏á‡∏à‡∏π‡∏á‡πÉ‡∏à', '‡∏Ç‡∏≤‡∏î‡πÅ‡∏Å‡∏ô‡∏ô‡∏≥‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô'].forEach(val => {
                                        document.write(`
                                            <label class="cursor-pointer block">
                                                <input type="checkbox" name="q27" value="${val}" class="peer sr-only">
                                                <div class="option-card px-5 py-4 rounded-xl border border-brand-200 bg-white flex items-center gap-3 hover:bg-brand-50">
                                                    <div class="w-5 h-5 rounded border border-brand-300 flex items-center justify-center shrink-0 peer-checked:bg-brand-500 peer-checked:border-brand-500 text-white"><svg class="w-3 h-3 opacity-0 peer-checked:opacity-100" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg></div>
                                                    <span class="text-sm text-brand-700">${val}</span>
                                                </div>
                                            </label>
                                        `);
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 6: Suggestions -->
                <div id="step6" class="step-content p-8 md:p-12">
                     <h2 class="text-2xl font-bold mb-8 text-brand-900 flex items-center gap-3 pb-4 border-b border-brand-100">
                        <span class="flex items-center justify-center w-10 h-10 rounded-full bg-brand-100 text-brand-600 text-lg shadow-sm">6</span>
                        ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                    </h2>

                    <div class="bg-gold-400/10 border-l-4 border-gold-400 p-5 rounded-r-xl mb-8">
                        <p class="text-xs md:text-sm text-gold-600 font-medium">
                            <strong>‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô PDPA:</strong> ‡πÇ‡∏õ‡∏£‡∏î‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•, ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
                        </p>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <label class="block font-bold mb-2 text-brand-800 text-lg">28. ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Key Success Factor)</label>
                            <textarea name="q28" rows="3" class="w-full border border-brand-200 rounded-2xl p-4 focus:ring-2 focus:ring-brand-400 focus:border-brand-400 outline-none transition-all text-brand-900 bg-white" oninput="checkPII(this)"></textarea>
                            <p class="text-xs text-brand-500 mt-1 hidden" id="q28-error"></p>
                        </div>
                        <div>
                            <label class="block font-bold mb-2 text-brand-800 text-lg">29. ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏ï‡πà‡∏≠ ‡∏™‡∏Ñ‡∏£.7</label>
                            <textarea name="q29" rows="3" class="w-full border border-brand-200 rounded-2xl p-4 focus:ring-2 focus:ring-brand-400 focus:border-brand-400 outline-none transition-all text-brand-900 bg-white" oninput="checkPII(this)"></textarea>
                            <p class="text-xs text-brand-500 mt-1 hidden" id="q29-error"></p>
                        </div>
                        <div>
                            <label class="block font-bold mb-2 text-brand-800 text-lg">30. ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                            <textarea name="q30" rows="3" class="w-full border border-brand-200 rounded-2xl p-4 focus:ring-2 focus:ring-brand-400 focus:border-brand-400 outline-none transition-all text-brand-900 bg-white" oninput="checkPII(this)"></textarea>
                            <p class="text-xs text-brand-500 mt-1 hidden" id="q30-error"></p>
                        </div>
                    </div>
                </div>

                <!-- Footer / Nav -->
                <div class="bg-white/50 px-8 py-8 border-t border-brand-100 flex flex-col-reverse md:flex-row justify-between items-center gap-5 backdrop-blur-sm rounded-b-[2rem]">
                    <button type="button" id="prevBtn" class="hidden px-6 py-3 rounded-full text-brand-500 font-bold hover:bg-brand-50 transition-colors" onclick="changeStep(-1)">
                        ‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <div class="flex gap-4 w-full md:w-auto justify-end">
                        <button type="button" id="draftBtn" class="hidden px-6 py-3 rounded-full bg-gold-400/20 text-gold-600 font-bold hover:bg-gold-400/30 transition-colors text-sm" onclick="saveDraft()">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á
                        </button>
                        <button type="button" id="nextBtn" class="flex-1 md:flex-none px-10 py-3 rounded-full bg-brand-500 text-white font-bold hover:bg-brand-600 transition-all shadow-lg shadow-brand-500/30 transform hover:-translate-y-1" onclick="changeStep(1)">
                            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                        </button>
                        <button type="submit" id="submitBtn" class="hidden flex-1 md:flex-none px-10 py-3 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold hover:from-emerald-600 hover:to-teal-600 transition-all shadow-lg shadow-emerald-500/30 transform hover:-translate-y-1" onclick="submitForm()">
                            ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
                        </button>
                    </div>
                </div>

            </form>
        </div>

        <!-- DASHBOARD OVERLAY -->
        <div id="dashboardView" class="fixed inset-0 bg-brand-900/95 backdrop-blur-xl z-50 hidden overflow-y-auto custom-scrollbar transition-opacity duration-300">
            <div class="max-w-7xl mx-auto p-4 md:p-8">
                <div class="flex justify-between items-center mb-8 sticky top-0 bg-brand-900/90 z-10 py-2 backdrop-blur-md">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Executive Dashboard</h2>
                        <p class="text-brand-200 text-sm">Real-time Data Visualization</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="exportToWord()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-full text-sm font-bold transition-all shadow-lg flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            Export Word
                        </button>
                        <button onclick="toggleDashboard()" class="bg-white/10 text-white hover:bg-white/20 rounded-full p-2 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                </div>
                
                <div id="dashboardLoading" class="flex flex-col items-center justify-center h-96">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-brand-400 mb-4"></div>
                    <p class="text-brand-200">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>

                <div id="dashboardContent" class="hidden space-y-8 animate__animated animate__fadeIn pb-10">
                    
                    <!-- 1. KPI Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white/10 border border-white/10 p-6 rounded-3xl backdrop-blur-md hover:bg-white/15 transition-all">
                            <h3 class="text-brand-200 text-sm uppercase tracking-wider mb-2 font-bold">Total Responses</h3>
                            <p class="text-5xl font-bold text-white" id="statTotal">0</p>
                        </div>
                        <div class="bg-white/10 border border-white/10 p-6 rounded-3xl backdrop-blur-md hover:bg-white/15 transition-all">
                            <h3 class="text-brand-200 text-sm uppercase tracking-wider mb-2 font-bold">Avg. Readiness</h3>
                            <div class="flex items-end gap-2"><p class="text-5xl font-bold text-emerald-300" id="statReadiness">0.0</p><span class="text-sm text-brand-300 mb-2 font-bold">/ 5.0</span></div>
                        </div>
                        <div class="bg-white/10 border border-white/10 p-6 rounded-3xl backdrop-blur-md hover:bg-white/15 transition-all">
                            <h3 class="text-brand-200 text-sm uppercase tracking-wider mb-2 font-bold">Avg. Needs Support</h3>
                            <div class="flex items-end gap-2"><p class="text-5xl font-bold text-gold-300" id="statNeeds">0.0</p><span class="text-sm text-brand-300 mb-2 font-bold">/ 5.0</span></div>
                        </div>
                    </div>

                    <!-- 2. Data Summary Tables -->
                    <h3 class="text-2xl text-white font-bold border-l-4 border-gold-400 pl-4">üìä Data Summary Tables</h3>
                    <div id="dataTables" class="space-y-6"></div>

                    <!-- 3. General Info Section -->
                    <h3 class="text-2xl text-white font-bold border-l-4 border-gold-400 pl-4">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (General Info)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="chart-card"><h4 class="chart-title">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (Agency)</h4><canvas id="chartQ1"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (Province)</h4><canvas id="chartQ2"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Role)</h4><canvas id="chartQ3"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå (Experience)</h4><canvas id="chartQ4"></canvas></div>
                    </div>

                    <!-- 4. Situation Section (All Bar Charts) -->
                    <h3 class="text-2xl text-white font-bold border-l-4 border-gold-400 pl-4">2. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå (Situation)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="chart-card"><h4 class="chart-title">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h4><canvas id="chartQ5"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à</h4><canvas id="chartQ6"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡∏´‡∏•‡∏±‡∏Å</h4><canvas id="chartQ9"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ HbA1c < 7%</h4><canvas id="chartQ7"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á</h4><canvas id="chartQ8"></canvas></div>
                    </div>

                    <!-- 5. Readiness vs Support -->
                    <h3 class="text-2xl text-white font-bold border-l-4 border-gold-400 pl-4">3. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="chart-card"><h4 class="chart-title">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô (Avg.)</h4><canvas id="chartReadiness"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏£‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô (Avg.)</h4><canvas id="chartSupport"></canvas></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="chart-card"><h4 class="chart-title">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á?</h4><canvas id="chartQ16"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</h4><canvas id="chartQ17"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</h4><canvas id="chartQ18"></canvas></div>
                    </div>

                    <!-- 6. Area Specific (Bar Chart for Q25) -->
                    <h3 class="text-2xl text-white font-bold border-l-4 border-gold-400 pl-4">4. ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (Area Specific)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="chart-card"><h4 class="chart-title">‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏•‡∏î‡∏û‡∏∏‡∏á?</h4><canvas id="chartQ25"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥</h4><canvas id="chartQ26"></canvas></div>
                        <div class="chart-card"><h4 class="chart-title">‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</h4><canvas id="chartQ27"></canvas></div>
                    </div>

                    <!-- 7. Suggestions -->
                    <div class="bg-white/10 border border-white/10 rounded-3xl p-8 backdrop-blur-md">
                         <h4 class="font-bold text-white mb-6 flex items-center gap-3 text-xl">
                            <span class="text-gold-400">üí¨</span> ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Latest Suggestions)
                        </h4>
                        <div id="suggestionsList" class="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar"></div>
                    </div>

                    <p class="text-center text-xs text-brand-300/50 mt-10">Last update: <span id="lastUpdate"></span></p>
                </div>
            </div>
        </div>

        <footer class="text-center mt-16 text-sm text-brand-400/70 pb-10">
             <div class="flex justify-center items-center gap-3 mb-3">
                 <div class="h-px w-10 bg-brand-200"></div>
                 <span class="font-semibold tracking-wide">DPC 7 Khon Kaen</span>
                 <div class="h-px w-10 bg-brand-200"></div>
             </div>
             <p class="text-xs">¬© 2024 NCDs Bureau. All rights reserved.</p>
        </footer>

    </main>

    <!-- Logic Script -->
    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxQa2jkmTYcR_nigtVUhPtnHNP4qLi5_XS61MIpKSx3vpDOfx647diFcnKF1vrY3BFZ/exec'; 
        
        const DRAFT_KEY = 'ncd_remission_lux_v1';
        const TOTAL_STEPS = 6;
        let currentStep = 0;
        let globalDashboardData = null; // Store dashboard data globally for export
        
        const PII_PATTERNS = [
            { regex: /\b\d{13}\b/, msg: "‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô" },
            { regex: /\b(06|08|09)\d{8}\b|\b0\d{8}\b/, msg: "‡∏û‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" },
            { regex: /[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}/, msg: "‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            loadDraft();
            updateUI();
        });

        // --- Dashboard Functions ---
        function toggleDashboard() {
            const el = document.getElementById('dashboardView');
            const body = document.body;
            if (el.classList.contains('hidden')) {
                el.classList.remove('hidden');
                body.style.overflow = 'hidden';
                fetchDashboardData();
            } else {
                el.classList.add('hidden');
                body.style.overflow = 'auto';
            }
        }

        function fetchDashboardData() {
            const loading = document.getElementById('dashboardLoading');
            const content = document.getElementById('dashboardContent');
            
            loading.classList.remove('hidden');
            content.classList.add('hidden');

            fetch(APPS_SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                if(data.result === 'error') throw new Error(data.error);
                loading.classList.add('hidden');
                content.classList.remove('hidden');
                globalDashboardData = data; // Store globally
                renderDashboard(data);
            })
            .catch(err => {
                console.error(err);
                loading.innerHTML = '<p class="text-red-400">Connection Failed</p>';
                // Fallback for demo if API fails
                mockRender();
            });
        }
        
        function mockRender() {
            const mockData = {
                total_responses: 42,
                avg_readiness: 3.8,
                avg_needs: 4.5,
                q1_agency: {"‡∏™‡∏™‡∏à.":5,"‡∏£‡∏û‡∏®./‡∏£‡∏û‡∏ó.":10,"‡∏£‡∏û‡∏ä.":15,"‡∏™‡∏™‡∏≠.":8,"‡∏£‡∏û.‡∏™‡∏ï.":4},
                q2_province: {"‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î":10,"‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô":20,"‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°":8,"‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå":4},
                q3_role: {"‡πÅ‡∏û‡∏ó‡∏¢‡πå":5,"‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•":20,"‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£":10,"‡∏≠‡∏∑‡πà‡∏ô‡πÜ":7},
                q4_experience: {"‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏õ‡∏µ":10,"1 - 3 ‡∏õ‡∏µ":15,"10 ‡∏õ‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ":5},
                q5_status: {"‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô":10,"‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°":20,"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô":12},
                q6_knowledge: {"‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏î‡∏µ":15,"‡∏û‡∏≠‡∏£‡∏π‡πâ‡∏ö‡πâ‡∏≤‡∏á":20,"‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô":7},
                q7_hba1c: {"< 20%":10,"20-39%":15,"> 60%":5},
                q8_waist: {"< 20%":12,"20-39%":18},
                q9_obstacles: {"‡∏Ç‡∏≤‡∏î‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£":25,"‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ":20,"‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÑ‡∏°‡πà‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠":15},
                readiness_scores: [3.5, 3.8, 3.2, 3.0, 4.0, 2.5],
                q16_need_guide: {"‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏Å":30,"‡πÄ‡∏â‡∏¢‡πÜ":10,"‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£":2},
                q17_content: {"‡∏ô‡∏¥‡∏¢‡∏≤‡∏°":35,"Flow Chart":28,"‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô":25},
                q18_format: {"E-book":20,"App":15,"Infographic":7},
                support_scores: [4.5, 4.2, 4.8, 3.5, 4.0, 3.8],
                q25_program: {"‡∏°‡∏µ":15,"‡∏°‡∏µ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á":10,"‡πÑ‡∏°‡πà‡∏°‡∏µ":17},
                q26_activities: {"DPAC":20,"‡∏£‡∏ì‡∏£‡∏á‡∏Ñ‡πå":15},
                q27_area_obstacles: {"‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏¥‡∏ô":30,"‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°":10},
                suggestions: [{text:"‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"}, {text:"‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡πÅ‡∏ö‡∏ö E-book"}]
            };
            document.getElementById('dashboardLoading').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');
            globalDashboardData = mockData;
            renderDashboard(mockData);
             Swal.fire({
                icon: 'info',
                title: 'Simulation Mode',
                text: 'Showing mock data because backend connection failed.',
                toast: true, position: 'bottom-end', showConfirmButton: false, timer: 3000
            });
        }

        let charts = {};

        function renderDashboard(data) {
            // Ensure data objects exist
            data.q1_agency = data.q1_agency || {};
            data.q2_province = data.q2_province || {};
            data.q3_role = data.q3_role || {};
            data.q4_experience = data.q4_experience || {};
            data.q5_status = data.q5_status || {};
            data.q6_knowledge = data.q6_knowledge || {};
            data.q7_hba1c = data.q7_hba1c || {};
            data.q8_waist = data.q8_waist || {};
            data.q9_obstacles = data.q9_obstacles || {};
            data.q16_need_guide = data.q16_need_guide || {};
            data.q17_content = data.q17_content || {};
            data.q18_format = data.q18_format || {};
            data.q25_program = data.q25_program || {};
            data.q26_activities = data.q26_activities || {};
            data.q27_area_obstacles = data.q27_area_obstacles || {};
            data.readiness_scores = data.readiness_scores || [0,0,0,0,0,0];
            data.support_scores = data.support_scores || [0,0,0,0,0,0];
            data.avg_readiness = data.avg_readiness || 0;
            data.avg_needs = data.avg_needs || 0;
            data.total_responses = data.total_responses || 0;

            document.getElementById('statTotal').innerText = data.total_responses;
            document.getElementById('statReadiness').innerText = data.avg_readiness.toFixed(2);
            document.getElementById('statNeeds').innerText = data.avg_needs.toFixed(2);
            document.getElementById('lastUpdate').innerText = new Date().toLocaleString('th-TH');

            // Render Summary Tables
            renderDataTables(data);

            // Helper to create chart
            const createChart = (id, type, labels, values, labelStr, colors) => {
                if (charts[id]) charts[id].destroy();
                const ctx = document.getElementById(id).getContext('2d');
                charts[id] = new Chart(ctx, {
                    type: type,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: labelStr,
                            data: values,
                            backgroundColor: colors || ['#f43f5e','#fb7185','#fda4af','#fecdd3','#ffe4e6','#be123c', '#fbbf24', '#10b981', '#6366f1'],
                            borderWidth: 1
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: true,
                        plugins: { legend: { display: type !== 'bar', position: 'bottom' } },
                        scales: type === 'bar' ? { 
                            y: { beginAtZero: true },
                            x: { ticks: { autoSkip: false, maxRotation: 45, minRotation: 0 } }
                        } : {}
                    }
                });
            };

            // 1. General Info
            createChart('chartQ1', 'doughnut', Object.keys(data.q1_agency), Object.values(data.q1_agency), '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô');
            createChart('chartQ2', 'bar', Object.keys(data.q2_province), Object.values(data.q2_province), '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '#f43f5e');
            createChart('chartQ3', 'bar', Object.keys(data.q3_role), Object.values(data.q3_role), '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', '#fbbf24');
            createChart('chartQ4', 'bar', Object.keys(data.q4_experience), Object.values(data.q4_experience), '‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå', '#10b981');

            // 2. Situation (ALL BAR CHARTS)
            createChart('chartQ5', 'bar', Object.keys(data.q5_status), Object.values(data.q5_status), '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '#f43f5e');
            createChart('chartQ6', 'bar', Object.keys(data.q6_knowledge), Object.values(data.q6_knowledge), '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ', '#fb7185');
            createChart('chartQ7', 'bar', Object.keys(data.q7_hba1c), Object.values(data.q7_hba1c), 'HbA1c', '#6366f1');
            createChart('chartQ8', 'bar', Object.keys(data.q8_waist), Object.values(data.q8_waist), '‡∏•‡∏á‡∏û‡∏∏‡∏á', '#8b5cf6');
            createChart('chartQ9', 'bar', Object.keys(data.q9_obstacles), Object.values(data.q9_obstacles), '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', '#ef4444');

            // 3. Readiness vs Needs - Radar
            if (charts['chartReadiness']) charts['chartReadiness'].destroy();
            charts['chartReadiness'] = new Chart(document.getElementById('chartReadiness'), {
                type: 'radar',
                data: {
                    labels: ['‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢', '‡∏ó‡∏±‡∏Å‡∏©‡∏∞', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì'],
                    datasets: [{ label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', data: data.readiness_scores, backgroundColor: 'rgba(244, 63, 94, 0.2)', borderColor: '#f43f5e', pointBackgroundColor: '#f43f5e' }]
                },
                options: { scales: { r: { min: 0, max: 5 } } }
            });
            
            if (charts['chartSupport']) charts['chartSupport'].destroy();
            charts['chartSupport'] = new Chart(document.getElementById('chartSupport'), {
                type: 'radar',
                data: {
                    labels: ['‡∏≠‡∏ö‡∏£‡∏°', '‡∏™‡∏∑‡πà‡∏≠', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì', '‡πÄ‡∏ß‡∏ó‡∏µ', '‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', '‡∏ô‡∏¥‡πÄ‡∏ó‡∏®'],
                    datasets: [{ label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', data: data.support_scores, backgroundColor: 'rgba(251, 191, 36, 0.2)', borderColor: '#fbbf24', pointBackgroundColor: '#fbbf24' }]
                },
                options: { scales: { r: { min: 0, max: 5 } } }
            });

            // Change Q16 and Q18 to BAR charts
            createChart('chartQ16', 'bar', Object.keys(data.q16_need_guide), Object.values(data.q16_need_guide), '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á', '#f43f5e');
            createChart('chartQ17', 'bar', Object.keys(data.q17_content), Object.values(data.q17_content), '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', '#ec4899');
            createChart('chartQ18', 'bar', Object.keys(data.q18_format), Object.values(data.q18_format), '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠', '#a855f7');

            // 4. Area - Change Q25 to BAR
            createChart('chartQ25', 'bar', Object.keys(data.q25_program), Object.values(data.q25_program), '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°', '#f43f5e');
            createChart('chartQ26', 'bar', Object.keys(data.q26_activities), Object.values(data.q26_activities), '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', '#06b6d4');
            createChart('chartQ27', 'bar', Object.keys(data.q27_area_obstacles), Object.values(data.q27_area_obstacles), '‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà', '#f97316');

            // 5. Suggestions
            const list = document.getElementById('suggestionsList');
            list.innerHTML = '';
            if(data.suggestions && data.suggestions.length > 0) {
                data.suggestions.forEach(s => {
                    list.innerHTML += `<div class="bg-white/10 p-3 rounded-lg border border-white/5 text-white text-sm"><p>${s.text}</p></div>`;
                });
            } else {
                list.innerHTML = '<p class="text-white/50 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</p>';
            }
        }

        // NEW: Render Data Summary Tables
        function renderDataTables(data) {
            const container = document.getElementById('dataTables');
            container.innerHTML = '';

            const tableGroups = [
                {
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (General Info)',
                    tables: [
                        { name: '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô', data: data.q1_agency },
                        { name: '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', data: data.q2_province },
                        { name: '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', data: data.q3_role },
                        { name: '‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå', data: data.q4_experience }
                    ]
                },
                {
                    title: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå (Situation)',
                    tables: [
                        { name: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô', data: data.q5_status },
                        { name: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à', data: data.q6_knowledge },
                        { name: 'HbA1c < 7%', data: data.q7_hba1c },
                        { name: '‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á', data: data.q8_waist },
                        { name: '‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', data: data.q9_obstacles }
                    ]
                },
                {
                    title: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° & ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                    tables: [
                        { name: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á', data: data.q16_need_guide },
                        { name: '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', data: data.q17_content },
                        { name: '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠', data: data.q18_format }
                    ]
                },
                {
                    title: '‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà',
                    tables: [
                        { name: '‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏•‡∏î‡∏û‡∏∏‡∏á', data: data.q25_program },
                        { name: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥', data: data.q26_activities },
                        { name: '‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà', data: data.q27_area_obstacles }
                    ]
                }
            ];
            
            tableGroups.forEach(group => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'table-container';
                groupDiv.innerHTML = `<h4 class="text-xl font-bold text-brand-900 mb-4">${group.title}</h4>`;
                
                const tablesGrid = document.createElement('div');
                tablesGrid.className = 'grid grid-cols-1 md:grid-cols-2 gap-6';

                group.tables.forEach(table => {
                    const tableDiv = document.createElement('div');
                    const totalCount = Object.values(table.data).reduce((a, b) => a + b, 0);
                    
                    let tableHTML = `
                        <h5 class="font-bold text-brand-800 mb-2">${table.name}</h5>
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                        <th class="text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                        <th class="text-right">‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;

                    for (const [key, value] of Object.entries(table.data)) {
                        const percent = totalCount > 0 ? ((value / totalCount) * 100).toFixed(1) : 0;
                        tableHTML += `
                            <tr>
                                <td>${key}</td>
                                <td class="text-right font-semibold">${value}</td>
                                <td class="text-right text-brand-600">${percent}%</td>
                            </tr>
                        `;
                    }

                    tableHTML += `
                                    <tr class="bg-brand-50 font-bold">
                                        <td>‡∏£‡∏ß‡∏°</td>
                                        <td class="text-right">${totalCount}</td>
                                        <td class="text-right">100%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    `;

                    tableDiv.innerHTML = tableHTML;
                    tablesGrid.appendChild(tableDiv);
                });

                groupDiv.appendChild(tablesGrid);
                container.appendChild(groupDiv);
            });

            // Add Readiness & Support Score Tables
            const scoresDiv = document.createElement('div');
            scoresDiv.className = 'table-container';
            scoresDiv.innerHTML = `
                <h4 class="text-xl font-bold text-brand-900 mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h5 class="font-bold text-brand-800 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢)</h5>
                        <table class="data-table">
                            <thead><tr><th>‡∏î‡πâ‡∏≤‡∏ô</th><th class="text-right">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr></thead>
                            <tbody>
                                ${['‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢', '‡∏ó‡∏±‡∏Å‡∏©‡∏∞', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì'].map((label, i) => 
                                    `<tr><td>${label}</td><td class="text-right font-semibold">${data.readiness_scores[i].toFixed(2)}</td></tr>`
                                ).join('')}
                                <tr class="bg-brand-50 font-bold">
                                    <td>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏ß‡∏°</td>
                                    <td class="text-right">${data.avg_readiness.toFixed(2)}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <h5 class="font-bold text-brand-800 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢)</h5>
                        <table class="data-table">
                            <thead><tr><th>‡∏î‡πâ‡∏≤‡∏ô</th><th class="text-right">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr></thead>
                            <tbody>
                                ${['‡∏≠‡∏ö‡∏£‡∏°', '‡∏™‡∏∑‡πà‡∏≠', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì', '‡πÄ‡∏ß‡∏ó‡∏µ', '‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', '‡∏ô‡∏¥‡πÄ‡∏ó‡∏®'].map((label, i) => 
                                    `<tr><td>${label}</td><td class="text-right font-semibold">${data.support_scores[i].toFixed(2)}</td></tr>`
                                ).join('')}
                                <tr class="bg-brand-50 font-bold">
                                    <td>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏ß‡∏°</td>
                                    <td class="text-right">${data.avg_needs.toFixed(2)}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            container.appendChild(scoresDiv);
        }

        // NEW: Export to Word Function
        async function exportToWord() {
            if (!globalDashboardData) {
                Swal.fire({ icon: 'error', title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏´‡∏•‡∏î Dashboard ‡∏Å‡πà‡∏≠‡∏ô', confirmButtonColor: '#be123c' });
                return;
            }

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => { Swal.showLoading(); }
            });

            try {
                const { Document, Paragraph, TextRun, Table, TableRow, TableCell, WidthType, AlignmentType, HeadingLevel, BorderStyle } = docx;
                
                const data = globalDashboardData;
                
                // Document sections
                const sections = [];
                
                // Title
                sections.push(
                    new Paragraph({
                        text: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏ß‡∏à NCDs Remission",
                        heading: HeadingLevel.HEADING_1,
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 400 }
                    }),
                    new Paragraph({
                        text: `‡πÄ‡∏Ç‡∏ï‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 7 ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô`,
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        text: `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleDateString('th-TH')}`,
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 600 }
                    })
                );

                // Summary Statistics
                sections.push(
                    new Paragraph({
                        text: "‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°",
                        heading: HeadingLevel.HEADING_2,
                        spacing: { before: 400, after: 200 }
                    }),
                    new Paragraph({
                        children: [
                            new TextRun({ text: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°: ", bold: true }),
                            new TextRun(`${data.total_responses} ‡∏Ñ‡∏ô`)
                        ],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [
                            new TextRun({ text: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°: ", bold: true }),
                            new TextRun(`${data.avg_readiness.toFixed(2)} / 5.0`)
                        ],
                        spacing: { after: 100 }
                    }),
                    new Paragraph({
                        children: [
                            new TextRun({ text: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô: ", bold: true }),
                            new TextRun(`${data.avg_needs.toFixed(2)} / 5.0`)
                        ],
                        spacing: { after: 400 }
                    })
                );

                // Helper function to create table
                const createDataTable = (title, dataObj) => {
                    const totalCount = Object.values(dataObj).reduce((a, b) => a + b, 0);
                    const rows = [
                        new TableRow({
                            children: [
                                new TableCell({ children: [new Paragraph({ text: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", bold: true })], shading: { fill: "F43F5E" } }),
                                new TableCell({ children: [new Paragraph({ text: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô", bold: true, alignment: AlignmentType.RIGHT })], shading: { fill: "F43F5E" } }),
                                new TableCell({ children: [new Paragraph({ text: "‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞", bold: true, alignment: AlignmentType.RIGHT })], shading: { fill: "F43F5E" } })
                            ]
                        })
                    ];

                    for (const [key, value] of Object.entries(dataObj)) {
                        const percent = totalCount > 0 ? ((value / totalCount) * 100).toFixed(1) : 0;
                        rows.push(
                            new TableRow({
                                children: [
                                    new TableCell({ children: [new Paragraph(key)] }),
                                    new TableCell({ children: [new Paragraph({ text: String(value), alignment: AlignmentType.RIGHT })] }),
                                    new TableCell({ children: [new Paragraph({ text: `${percent}%`, alignment: AlignmentType.RIGHT })] })
                                ]
                            })
                        );
                    }

                    // Total row
                    rows.push(
                        new TableRow({
                            children: [
                                new TableCell({ children: [new Paragraph({ text: "‡∏£‡∏ß‡∏°", bold: true })], shading: { fill: "FFE4E6" } }),
                                new TableCell({ children: [new Paragraph({ text: String(totalCount), bold: true, alignment: AlignmentType.RIGHT })], shading: { fill: "FFE4E6" } }),
                                new TableCell({ children: [new Paragraph({ text: "100%", bold: true, alignment: AlignmentType.RIGHT })], shading: { fill: "FFE4E6" } })
                            ]
                        })
                    );

                    return [
                        new Paragraph({ text: title, heading: HeadingLevel.HEADING_3, spacing: { before: 300, after: 150 } }),
                        new Table({
                            width: { size: 100, type: WidthType.PERCENTAGE },
                            rows: rows
                        }),
                        new Paragraph({ text: "", spacing: { after: 200 } })
                    ];
                };

                // Add all data tables
                sections.push(...createDataTable("1. ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î", data.q1_agency));
                sections.push(...createDataTable("2. ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", data.q2_province));
                sections.push(...createDataTable("3. ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó", data.q3_role));
                sections.push(...createDataTable("4. ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏á‡∏≤‡∏ô NCDs", data.q4_experience));
                sections.push(...createDataTable("5. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", data.q5_status));
                sections.push(...createDataTable("6. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏Å‡∏ì‡∏ë‡πå/‡∏ô‡∏¥‡∏¢‡∏≤‡∏°", data.q6_knowledge));
                sections.push(...createDataTable("7. ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ HbA1c < 7%", data.q7_hba1c));
                sections.push(...createDataTable("8. ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏≠‡πâ‡∏ß‡∏ô‡∏•‡∏á‡∏û‡∏∏‡∏á", data.q8_waist));
                sections.push(...createDataTable("9. ‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ", data.q9_obstacles));
                sections.push(...createDataTable("16. ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á", data.q16_need_guide));
                sections.push(...createDataTable("17. ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£", data.q17_content));
                sections.push(...createDataTable("18. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£", data.q18_format));
                sections.push(...createDataTable("25. ‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏•‡∏î‡∏û‡∏∏‡∏á", data.q25_program));
                sections.push(...createDataTable("26. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£", data.q26_activities));
                sections.push(...createDataTable("27. ‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà", data.q27_area_obstacles));

                // Readiness Scores
                sections.push(
                    new Paragraph({ text: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° (‡∏£‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô)", heading: HeadingLevel.HEADING_3, spacing: { before: 300, after: 150 } }),
                    new Table({
                        width: { size: 100, type: WidthType.PERCENTAGE },
                        rows: [
                            new TableRow({
                                children: [
                                    new TableCell({ children: [new Paragraph({ text: "‡∏î‡πâ‡∏≤‡∏ô", bold: true })], shading: { fill: "F43F5E" } }),
                                    new TableCell({ children: [new Paragraph({ text: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢", bold: true, alignment: AlignmentType.RIGHT })], shading: { fill: "F43F5E" } })
                                ]
                            }),
                            ...['‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢', '‡∏ó‡∏±‡∏Å‡∏©‡∏∞', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì'].map((label, i) => 
                                new TableRow({
                                    children: [
                                        new TableCell({ children: [new Paragraph(label)] }),
                                        new TableCell({ children: [new Paragraph({ text: data.readiness_scores[i].toFixed(2), alignment: AlignmentType.RIGHT })] })
                                    ]
                                })
                            ),
                            new TableRow({
                                children: [
                                    new TableCell({ children: [new Paragraph({ text: "‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏ß‡∏°", bold: true })], shading: { fill: "FFE4E6" } }),
                                    new TableCell({ children: [new Paragraph({ text: data.avg_readiness.toFixed(2), bold: true, alignment: AlignmentType.RIGHT })], shading: { fill: "FFE4E6" } })
                                ]
                            })
                        ]
                    }),
                    new Paragraph({ text: "", spacing: { after: 200 } })
                );

                // Support Scores
                sections.push(
                    new Paragraph({ text: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô (‡∏£‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô)", heading: HeadingLevel.HEADING_3, spacing: { before: 300, after: 150 } }),
                    new Table({
                        width: { size: 100, type: WidthType.PERCENTAGE },
                        rows: [
                            new TableRow({
                                children: [
                                    new TableCell({ children: [new Paragraph({ text: "‡∏î‡πâ‡∏≤‡∏ô", bold: true })], shading: { fill: "FBBF24" } }),
                                    new TableCell({ children: [new Paragraph({ text: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢", bold: true, alignment: AlignmentType.RIGHT })], shading: { fill: "FBBF24" } })
                                ]
                            }),
                            ...['‡∏≠‡∏ö‡∏£‡∏°', '‡∏™‡∏∑‡πà‡∏≠', '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì', '‡πÄ‡∏ß‡∏ó‡∏µ', '‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á', '‡∏ô‡∏¥‡πÄ‡∏ó‡∏®'].map((label, i) => 
                                new TableRow({
                                    children: [
                                        new TableCell({ children: [new Paragraph(label)] }),
                                        new TableCell({ children: [new Paragraph({ text: data.support_scores[i].toFixed(2), alignment: AlignmentType.RIGHT })] })
                                    ]
                                })
                            ),
                            new TableRow({
                                children: [
                                    new TableCell({ children: [new Paragraph({ text: "‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏ß‡∏°", bold: true })], shading: { fill: "FEF3C7" } }),
                                    new TableCell({ children: [new Paragraph({ text: data.avg_needs.toFixed(2), bold: true, alignment: AlignmentType.RIGHT })], shading: { fill: "FEF3C7" } })
                                ]
                            })
                        ]
                    })
                );

                // Suggestions
                if (data.suggestions && data.suggestions.length > 0) {
                    sections.push(
                        new Paragraph({ text: "‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞", heading: HeadingLevel.HEADING_2, spacing: { before: 400, after: 200 } })
                    );
                    data.suggestions.forEach((s, i) => {
                        sections.push(
                            new Paragraph({
                                text: `${i + 1}. ${s.text}`,
                                spacing: { after: 100 }
                            })
                        );
                    });
                }

                // Create document
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: sections
                    }]
                });

                // Generate and download
                const blob = await docx.Packer.toBlob(doc);
                saveAs(blob, `NCDs_Remission_Report_${new Date().toISOString().split('T')[0]}.docx`);
                
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡πÑ‡∏ü‡∏•‡πå Word ‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#10b981'
                });

            } catch (error) {
                console.error('Export error:', error);
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Word ‡πÑ‡∏î‡πâ: ' + error.message,
                    confirmButtonColor: '#be123c'
                });
            }
        }

        // --- Form Logic Functions ---
        function handleSpecificInput(selectName, inputId) {
            const select = document.querySelector(`select[name="${selectName}"]`);
            const input = document.getElementById(inputId);
            
            if (select.value && select.value !== "") { 
                input.disabled = false; 
                input.classList.remove('bg-brand-50');
                
                if (select.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                     input.placeholder = "‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏...";
                     input.focus();
                } else {
                     input.placeholder = "‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)";
                }
            } else { 
                input.disabled = true; 
                input.value = ''; 
                input.classList.add('bg-brand-50');
            }
        }

        function toggleCheckboxOther(checkbox, inputId) {
            const input = document.getElementById(inputId);
            if (checkbox.checked) { input.disabled = false; input.focus(); } 
            else { input.disabled = true; input.value = ''; }
        }

        function checkPII(element) {
            let found = false;
            PII_PATTERNS.forEach(p => { if (p.regex.test(element.value)) found = true; });
            const errorEl = document.getElementById(element.name + '-error');
            const submitBtn = document.getElementById('submitBtn');
            if (found) {
                element.classList.add('pii-warning');
                errorEl.innerText = "‚ö†Ô∏è ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£/‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£/‡∏≠‡∏µ‡πÄ‡∏°‡∏•) ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏≠‡∏≠‡∏Å";
                errorEl.classList.remove('hidden');
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                element.classList.remove('pii-warning');
                errorEl.classList.add('hidden');
                if (document.querySelectorAll('.pii-warning').length === 0) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
        }

        function checkConsent(value) {
            if (value === 'disagree') {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏ó‡πà‡∏≤‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°',
                    text: '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',
                    confirmButtonColor: '#9f1239'
                }).then(() => {
                    localStorage.removeItem(DRAFT_KEY);
                    window.location.reload();
                });
            }
        }

        function changeStep(n) {
            if (n === 1 && !validateStep(currentStep)) return;
            const steps = document.getElementsByClassName("step-content");
            steps[currentStep].classList.remove("active");
            currentStep += n;
            steps[currentStep].classList.add("active");
            updateUI();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateUI() {
            const percent = (currentStep / TOTAL_STEPS) * 100;
            document.getElementById("progressBar").style.width = percent + "%";
            document.getElementById("prevBtn").style.display = currentStep === 0 ? "none" : "block";
            document.getElementById("draftBtn").style.display = currentStep === 0 ? "none" : "block";
            document.getElementById("nextBtn").style.display = currentStep === TOTAL_STEPS ? "none" : "block";
            document.getElementById("submitBtn").style.display = currentStep === TOTAL_STEPS ? "block" : "none";
        }

        function validateStep(stepIndex) {
            const stepDiv = document.getElementById(`step${stepIndex}`);
            if (!stepDiv) return true;
            
            if (stepIndex === 0) {
                const c = document.querySelector('input[name="consent"]:checked');
                if (!c) { Swal.fire({ icon:'info', title:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°', confirmButtonColor: '#be123c' }); return false; }
                if (c.value === 'disagree') return false;
            }

            let isValid = true;
            const requiredFields = {
                1: ['q1', 'q2', 'q3', 'q4'],
                2: ['q5', 'q6', 'q7', 'q8', 'q9'],
                3: ['q10', 'q11', 'q12', 'q13', 'q14', 'q15'],
                4: ['q16', 'q17', 'q18', 'q19', 'q20', 'q21', 'q22', 'q23', 'q24'],
                5: ['q25', 'q26', 'q27']
            };
            const fields = requiredFields[stepIndex] || [];

            for (const f of fields) {
                let isFieldValid = false;
                let isOtherSelected = false;

                const select = document.querySelector(`select[name="${f}"]`);
                if (select) {
                    if (select.value && select.value !== "") { 
                        isFieldValid = true; 
                        if (select.value === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ") isOtherSelected = true;
                    }
                } else {
                    const checked = document.querySelectorAll(`input[name="${f}"]:checked`);
                    if (checked.length > 0) {
                        isFieldValid = true;
                        for (let i = 0; i < checked.length; i++) {
                            if (checked[i].value === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ") {
                                isOtherSelected = true;
                                break;
                            }
                        }
                    }
                }

                if (!isFieldValid) {
                    isValid = false;
                } else if (isOtherSelected) {
                    const otherInput = document.getElementById(`${f}_other`);
                    if (otherInput && !otherInput.value.trim()) {
                        isValid = false;
                    }
                }
            }

            if (!isValid) Swal.fire({ icon: 'warning', title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ * ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', confirmButtonColor: '#be123c' });
            return isValid;
        }

        function saveDraft() {
            const formData = new FormData(document.getElementById('assessmentForm'));
            const formObj = {};
            formData.forEach((v, k) => { if(!formObj[k]) formObj[k] = v; else formObj[k] += ',' + v; }); 
            localStorage.setItem(DRAFT_KEY, JSON.stringify({ step: currentStep, data: formObj }));
            Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', toast: true, position: 'top-end', showConfirmButton: false, timer: 1500 });
        }

        function loadDraft() {
            const saved = localStorage.getItem(DRAFT_KEY);
            if (!saved) return;
            Swal.fire({
                title: '‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á', text: '‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', icon: 'question',
                showCancelButton: true, confirmButtonText: '‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô', cancelButtonText: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà',
                confirmButtonColor: '#be123c'
            }).then((result) => {
                if (result.isConfirmed) {
                    const savedObj = JSON.parse(saved);
                    const data = savedObj.data;
                    currentStep = savedObj.step || 0;
                    
                    for (const [k, v] of Object.entries(data)) {
                        const el = document.getElementsByName(k);
                        if(el.length && (el[0].type === 'radio' || el[0].type === 'checkbox')) {
                           v.split(',').forEach(val => {
                               const match = document.querySelector(`input[name="${k}"][value="${val}"]`);
                               if(match) match.checked = true;
                               if(val === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') { const ot = document.getElementById(`${k}_other`); if(ot) { ot.disabled = false; ot.classList.remove('bg-brand-50'); } }
                           });
                        } else if(el.length) {
                            el[0].value = v;
                            if(v === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') { const ot = document.getElementById(`${k}_other`); if(ot) { ot.disabled = false; ot.classList.remove('bg-brand-50'); } }
                            const select = document.querySelector(`select[name="${k}"]`);
                            if(select && v) {
                                handleSpecificInput(k, `${k}_other`);
                            }
                        }
                    }
                    const steps = document.getElementsByClassName("step-content");
                    steps[0].classList.remove("active");
                    steps[currentStep].classList.add("active");
                    updateUI();
                } else { localStorage.removeItem(DRAFT_KEY); }
            });
        }

        function submitForm() {
            if (!validateStep(TOTAL_STEPS)) return;
            document.getElementById('loadingOverlay').classList.remove('hidden');

            const formData = new FormData(document.getElementById('assessmentForm'));
            const payload = {};
            for (let [key, val] of formData.entries()) {
                if (payload[key]) payload[key] += '; ' + val;
                else payload[key] = val;
            }
            payload.submitted_at = new Date().toISOString();

            fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            }).then(() => {
                localStorage.removeItem(DRAFT_KEY);
                document.getElementById('loadingOverlay').classList.add('hidden');
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                    text: '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#10b981'
                }).then(() => window.location.reload());
            }).catch(e => {
                console.error(e);
                document.getElementById('loadingOverlay').classList.add('hidden');
                Swal.fire('Error','‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            });
        }
    </script>
</body>
</html>
